<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpaCOAP: mouse spleen dataset • SpaCOAP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SpaCOAP: mouse spleen dataset">
<meta property="og:description" content="SpaCOAP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpaCOAP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mouseSpleen.html">SpaCOAP: mouse spleen dataset</a>
    </li>
    <li>
      <a href="../articles/simu.html">SpaCOAP: simulation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/feiyoung/SpaCOAP/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mouseSpleen_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="mouseSpleen_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="mouseSpleen_files/datatables-binding-0.21/datatables.js"></script><link href="mouseSpleen_files/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="mouseSpleen_files/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="mouseSpleen_files/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="mouseSpleen_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="mouseSpleen_files/crosstalk-1.2.0/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SpaCOAP: mouse spleen dataset</h1>
                        <h4 data-toc-skip class="author">Wei Liu</h4>
            
            <h4 data-toc-skip class="date">2024-05-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/feiyoung/SpaCOAP/blob/HEAD/vignettes/mouseSpleen.Rmd" class="external-link"><code>vignettes/mouseSpleen.Rmd</code></a></small>
      <div class="hidden name"><code>mouseSpleen.Rmd</code></div>

    </div>

    
    
<p>This vignette introduces the SpaCOAP workflow for the analysis of spatial multi-omics dataset.</p>
<p>We demonstrate the use of SpaCOAP to one mouse spleen data collected from the SPOTS platform that are <a href="https://github.com/feiyoung/SpaCOAP/tree/main/vignettes_data" class="external-link">here</a>, which can be downloaded to the current working path by the following command:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">url1</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/feiyoung/ProFAST/SpaCOAP/main/vignettes_data/"</span>
<span class="va">rna_object</span> <span class="op">&lt;-</span> <span class="st">"seu_rna_over_Spleen.RDS?raw=true"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">url1</span>, <span class="va">rna_object</span><span class="op">)</span>,<span class="st">"seu_rna_over_Spleen.RDS"</span>,mode<span class="op">=</span><span class="st">'wb'</span><span class="op">)</span>
<span class="va">protein_object</span> <span class="op">&lt;-</span> <span class="st">"seu_adt_over_Spleen.RDS?raw=true"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">url1</span>,<span class="va">protein_object</span><span class="op">)</span>, <span class="st">'seu_adt_over_Spleen.RDS'</span>, mode<span class="op">=</span><span class="st">'wb'</span><span class="op">)</span>
<span class="co">## download  annotation</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">url1</span>, <span class="st">"cell_clusters_anno.rds?raw=true"</span><span class="op">)</span>, <span class="st">"cell_clusters_anno.rds"</span>, <span class="st">"wb"</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<p>Then we load the data to R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seu_rna_over</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./seu_rna_over_Spleen.RDS"</span><span class="op">)</span>
<span class="va">seu_adt_over</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./seu_adt_over_Spleen.RDS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"./cell_clusters_anno.rds"</span><span class="op">)</span></code></pre></div>
<p>The package can be loaded with the command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/SpaCOAP" class="external-link">SpaCOAP</a></span><span class="op">)</span> <span class="co">#</span>
<span class="co">#&gt; SpaCOAP :  A spatial covariate-augmented overdispersed Poisson factor model is proposed to perform efficient latent representation learning method for high-dimensional large-scale spatial count data with additional covariates.   Check out our Package website (https://feiyoung.github.io/SpaCOAP/docs/index.html) for a more complete description of the methods and analyses</span></code></pre></div>
<p>Define some functions for use.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">searchRadius</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pos</span>, <span class="va">lower.med</span><span class="op">=</span><span class="fl">8</span>, <span class="va">upper.med</span><span class="op">=</span><span class="fl">10</span>, <span class="va">radius.upper</span><span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">pos</span>, <span class="st">"matrix"</span><span class="op">)</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"method is only for  matrix object!"</span><span class="op">)</span>
  
  
  <span class="co">## Automatically determine the upper radius</span>
  <span class="va">n_spots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span>
  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">n_spots</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">n_spots</span><span class="op">)</span><span class="op">)</span>
  <span class="va">dis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">pos</span><span class="op">[</span><span class="va">idx</span>,<span class="op">]</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">radius.upper</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="co">#radius.upper &lt;- max(dis)</span>
    <span class="va">radius.upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">dis</span><span class="op">)</span><span class="op">[</span><span class="fl">20</span><span class="op">]</span> <span class="co">## select the nearest 20 spots.</span>
  <span class="op">}</span>
  <span class="va">radius.lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dis</span><span class="op">[</span><span class="va">dis</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span>
  <span class="va">Adj_sp</span> <span class="op">&lt;-</span> <span class="fu">DR.SC</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/DR.SC/man/getneighborhood_fast.html" class="external-link">getneighborhood_fast</a></span><span class="op">(</span><span class="va">pos</span>, radius<span class="op">=</span><span class="va">radius.upper</span><span class="op">)</span>
  <span class="va">Med</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rrpack/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">Adj_sp</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">'Median'</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">Med</span> <span class="op">&lt;</span> <span class="va">lower.med</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"The radius.upper is too smaller that cannot find median neighbors greater than 4."</span><span class="op">)</span>
  <span class="va">start.radius</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="va">Med</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Find the adjacency matrix by bisection method..."</span><span class="op">)</span>
  <span class="va">maxIter</span> <span class="op">&lt;-</span> <span class="fl">30</span>
  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="kw">while</span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">Med</span> <span class="op">&gt;=</span> <span class="va">lower.med</span> <span class="op">&amp;&amp;</span> <span class="va">Med</span> <span class="op">&lt;=</span><span class="va">upper.med</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># ensure that each spot has about 4~6 neighborhoods in median.</span>
    
    <span class="va">Adj_sp</span> <span class="op">&lt;-</span> <span class="fu">DR.SC</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/DR.SC/man/getneighborhood_fast.html" class="external-link">getneighborhood_fast</a></span><span class="op">(</span><span class="va">pos</span>, radius<span class="op">=</span><span class="va">start.radius</span><span class="op">)</span>
    <span class="va">Med</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rrpack/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">Adj_sp</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">'Median'</span><span class="op">]</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">Med</span> <span class="op">&lt;</span> <span class="va">lower.med</span><span class="op">)</span><span class="op">{</span>
      <span class="va">radius.lower</span> <span class="op">&lt;-</span> <span class="va">start.radius</span>
      <span class="va">start.radius</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">radius.lower</span> <span class="op">+</span> <span class="va">radius.upper</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>
    <span class="op">}</span><span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">Med</span> <span class="op">&gt;</span><span class="va">upper.med</span><span class="op">)</span><span class="op">{</span>
      <span class="va">radius.upper</span> <span class="op">&lt;-</span> <span class="va">start.radius</span>
      <span class="va">start.radius</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">radius.lower</span> <span class="op">+</span> <span class="va">radius.upper</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>
    <span class="op">}</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Current radius is "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">start.radius</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Median of neighborhoods is "</span>, <span class="va">Med</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">k</span> <span class="op">&gt;</span> <span class="va">maxIter</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Reach the maximum iteration but can not find a proper radius!"</span><span class="op">)</span>
      <span class="kw">break</span>;
    <span class="op">}</span>
    <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span> <span class="op">+</span> <span class="fl">1</span>
  <span class="op">}</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">start.radius</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">acc_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y1</span>, <span class="va">y2</span><span class="op">)</span><span class="op">{</span>
  <span class="va">n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span><span class="op">)</span>
  <span class="va">n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">y2</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">n1</span><span class="op">&lt;</span><span class="va">n2</span><span class="op">)</span><span class="op">{</span> <span class="co">## ensure n1&gt; n2</span>
    <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">y1</span>
    <span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">y2</span>
    <span class="va">y2</span> <span class="op">&lt;-</span> <span class="va">a</span>
    <span class="va">n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span><span class="op">)</span>
    <span class="va">n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">y2</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>Actual <span class="op">=</span> <span class="va">y1</span>, Predicted <span class="op">=</span> <span class="va">y2</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rnames</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span>
  <span class="va">cnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span>
  <span class="va">union_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">union</a></span><span class="op">(</span><span class="va">rnames</span>, <span class="va">cnames</span><span class="op">)</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">union_names</span><span class="op">)</span>
  <span class="va">cm_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span>, <span class="va">n</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">cm_new</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cm_new</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">union_names</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">r</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n2</span><span class="op">)</span><span class="op">{</span>
    <span class="va">cm_new</span><span class="op">[</span><span class="va">rnames</span>,<span class="va">cnames</span><span class="op">[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cm</span><span class="op">[</span><span class="va">rnames</span>,<span class="va">cnames</span><span class="op">[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span>
  <span class="op">}</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cm_new</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">kappa_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y1</span>, <span class="va">y2</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://www.r-project.org" class="external-link">irr</a></span><span class="op">)</span>
  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y2</span><span class="op">)</span>
  <span class="va">k_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/irr/man/kappa2.html" class="external-link">kappa2</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
  <span class="va">k_res</span><span class="op">$</span><span class="va">value</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="view-the-dlpfc-data">View the DLPFC data<a class="anchor" aria-label="anchor" href="#view-the-dlpfc-data"></a>
</h2>
<p>Wrap the data matrix from the SeuratObject, including the RNA expression count matrix <code>X_count</code>, covraite matrix <code>H</code> associated with protein markters, control variables (here only an intercept term) <code>Z</code>, and spatial coordinate matrix <code>pos</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">X_count</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu">t</span><span class="op">(</span><span class="va">seu_rna_over</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">seu_rna_over</span><span class="op">[[</span><span class="st">'RNA'</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">var.features</span>,<span class="op">]</span><span class="op">)</span>
<span class="va">X_count</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X_count</span><span class="op">)</span>
<span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">seu_adt_over</span><span class="op">[[</span><span class="st">"ADT"</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>
<span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">H</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">seu_rna_over</span><span class="op">$</span><span class="va">X0</span>, <span class="va">seu_rna_over</span><span class="op">$</span><span class="va">X1</span><span class="op">)</span>


<span class="va">radius_use</span> <span class="op">&lt;-</span> <span class="fu">searchRadius</span><span class="op">(</span><span class="va">pos</span>, radius.upper <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="co">#&gt; Find the adjacency matrix by bisection method...</span>
<span class="co">#&gt; Current radius is 2.08</span>
<span class="co">#&gt; Median of neighborhoods is 0</span>
<span class="co">#&gt; Current radius is 2.08</span>
<span class="co">#&gt; Median of neighborhoods is 8</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">n_spots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span>
<span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">n_spots</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">n_spots</span><span class="op">)</span><span class="op">)</span>
<span class="va">dis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">pos</span><span class="op">[</span><span class="va">idx</span>,<span class="op">]</span><span class="op">)</span>
<span class="va">Adj_sp</span> <span class="op">&lt;-</span>  <span class="fu">SpaCOAP</span><span class="fu">:::</span><span class="fu">getneighbor_weightmat</span><span class="op">(</span><span class="va">pos</span>, radius <span class="op">=</span> <span class="va">radius_use</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">dis</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="determine-the-structure-dimension">Determine the structure dimension<a class="anchor" aria-label="anchor" href="#determine-the-structure-dimension"></a>
</h3>
<p>Next, we select the number of factors and the rank of regreesion coefficient matrix using the proposed criterion.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q_max</span> <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">H</span><span class="op">)</span>
<span class="va">rank_max</span> <span class="op">&lt;-</span> <span class="va">d</span>
<span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">reslist_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SpaCOAP.html">SpaCOAP</a></span><span class="op">(</span><span class="va">X_count</span>, <span class="va">Adj_sp</span>,  <span class="va">H</span>,  <span class="va">Z</span>,
                   rank_use <span class="op">=</span> <span class="va">rank_max</span>, q<span class="op">=</span><span class="va">q_max</span>, epsELBO <span class="op">=</span> <span class="fl">1e-8</span>,  maxIter <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="co">#&gt; Calculate initial values...</span>
<span class="co">#&gt; Loading required package: irlba</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="co">#&gt; Model fitting...</span>
<span class="co">#&gt; iter = 2, ELBO= -9105812.709850, dELBO=0.995760 </span>
<span class="co">#&gt; iter = 3, ELBO= -8593640.926646, dELBO=0.056247 </span>
<span class="co">#&gt; iter = 4, ELBO= -8407808.497651, dELBO=0.021624 </span>
<span class="co">#&gt; iter = 5, ELBO= -8755713.398839, dELBO=0.041379 </span>
<span class="co">#&gt; iter = 6, ELBO= -12239677.634492, dELBO=0.397908 </span>
<span class="co">#&gt; iter = 7, ELBO= -56250207.354883, dELBO=3.595726 </span>
<span class="co">#&gt; iter = 8, ELBO= -46562327.089930, dELBO=0.172228 </span>
<span class="co">#&gt; iter = 9, ELBO= -54307769.281638, dELBO=0.166346 </span>
<span class="co">#&gt; iter = 10, ELBO= -54264570.525545, dELBO=0.000795 </span>
<span class="co">#&gt; iter = 11, ELBO= -54226479.575290, dELBO=0.000702 </span>
<span class="co">#&gt; iter = 12, ELBO= -75166234.889874, dELBO=0.386154 </span>
<span class="co">#&gt; iter = 13, ELBO= -75157305.072706, dELBO=0.000119 </span>
<span class="co">#&gt; iter = 14, ELBO= -75333278.499290, dELBO=0.002341 </span>
<span class="co">#&gt; iter = 15, ELBO= -79607681.827268, dELBO=0.056740 </span>
<span class="co">#&gt; iter = 16, ELBO= -80401226.765462, dELBO=0.009968 </span>
<span class="co">#&gt; iter = 17, ELBO= -80385737.201267, dELBO=0.000193 </span>
<span class="co">#&gt; iter = 18, ELBO= -80371681.881248, dELBO=0.000175 </span>
<span class="co">#&gt; iter = 19, ELBO= -80359102.936542, dELBO=0.000157 </span>
<span class="co">#&gt; iter = 20, ELBO= -80347770.903197, dELBO=0.000141 </span>
<span class="co">#&gt; iter = 21, ELBO= -80337501.491998, dELBO=0.000128 </span>
<span class="co">#&gt; iter = 22, ELBO= -80328145.152885, dELBO=0.000116 </span>
<span class="co">#&gt; iter = 23, ELBO= -80319579.016351, dELBO=0.000107 </span>
<span class="co">#&gt; iter = 24, ELBO= -80311701.860722, dELBO=0.000098 </span>
<span class="co">#&gt; iter = 25, ELBO= -80304429.535540, dELBO=0.000091 </span>
<span class="co">#&gt; iter = 26, ELBO= -80297690.304512, dELBO=0.000084 </span>
<span class="co">#&gt; iter = 27, ELBO= -80291423.430452, dELBO=0.000078 </span>
<span class="co">#&gt; iter = 28, ELBO= -80285578.564637, dELBO=0.000073 </span>
<span class="co">#&gt; iter = 29, ELBO= -80280110.378034, dELBO=0.000068 </span>
<span class="co">#&gt; iter = 30, ELBO= -80274981.355221, dELBO=0.000064</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_spacoap_max</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></code></pre></div>
<p>We apply the criterion, taking into account that the real data does not necessarily originate from our model. Therefore, we opt for a conservative approach that retains more information.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">threshold</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-15</span>, <span class="fl">1e-20</span><span class="op">)</span>
<span class="va">thre1</span> <span class="op">&lt;-</span> <span class="va">threshold</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">beta_svalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">reslist_max</span><span class="op">$</span><span class="va">bbeta</span><span class="op">)</span><span class="op">$</span><span class="va">d</span>
<span class="va">beta_svalues</span> <span class="op">&lt;-</span> <span class="va">beta_svalues</span><span class="op">[</span><span class="va">beta_svalues</span><span class="op">&gt;</span><span class="va">thre1</span><span class="op">]</span>
<span class="va">ratio1</span> <span class="op">&lt;-</span> <span class="va">beta_svalues</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">beta_svalues</span><span class="op">)</span><span class="op">]</span> <span class="op">/</span> <span class="va">beta_svalues</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">ratio1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt;  [1] 2.319688 1.088212 1.125202 1.034595 1.042032 1.077762 1.086075 1.060918</span>
<span class="co">#&gt;  [9] 1.227194 1.019241</span>
<span class="co">## Here, we set hr = 9 rather 1 to retain more information</span>

<span class="va">thre2</span> <span class="op">&lt;-</span> <span class="va">threshold</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="va">B_svalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">reslist_max</span><span class="op">$</span><span class="va">B</span><span class="op">)</span><span class="op">$</span><span class="va">d</span>
<span class="va">B_svalues</span> <span class="op">&lt;-</span> <span class="va">B_svalues</span><span class="op">[</span><span class="va">B_svalues</span><span class="op">&gt;</span><span class="va">thre2</span><span class="op">]</span>
<span class="va">ratio_fac</span> <span class="op">&lt;-</span> <span class="va">B_svalues</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">B_svalues</span><span class="op">)</span><span class="op">]</span> <span class="op">/</span> <span class="va">B_svalues</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">ratio_fac</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>
<span class="co">#&gt; [1] 6.123909e+00 2.749414e+00 1.376498e+00 1.314487e+00 3.299859e+14</span>
<span class="co">#&gt; [6] 1.000000e+00</span>
<span class="co"># [1] 6.123909e+00 2.749414e+00 1.376498e+00 1.314487e+00 3.310699e+14</span>
<span class="co"># Here, we choose q=5 since huge decrease of singular values happen in q=5.</span>
<span class="va">hq</span> <span class="op">&lt;-</span> <span class="fl">5</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-spacoap">Fitting SpaCOAP<a class="anchor" aria-label="anchor" href="#fitting-spacoap"></a>
</h3>
<p>First, we run the proposed SpaCOAP method.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hr</span> <span class="op">&lt;-</span> <span class="fl">9</span>;<span class="va">hq</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">featureList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">reslist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SpaCOAP.html">SpaCOAP</a></span><span class="op">(</span><span class="va">X_count</span>, <span class="va">Adj_sp</span>, H<span class="op">=</span><span class="va">H</span>, Z<span class="op">=</span> <span class="va">Z</span>,  
                   rank_use <span class="op">=</span> <span class="va">hr</span>, q<span class="op">=</span><span class="va">hq</span>, epsELBO <span class="op">=</span> <span class="fl">1e-8</span><span class="op">)</span>
<span class="co">#&gt; Calculate initial values...</span>
<span class="co">#&gt; Model fitting...</span>
<span class="co">#&gt; iter = 2, ELBO= -4109208.136899, dELBO=0.998087 </span>
<span class="co">#&gt; iter = 3, ELBO= -2596761.245668, dELBO=0.368063 </span>
<span class="co">#&gt; iter = 4, ELBO= -2042396.907286, dELBO=0.213483 </span>
<span class="co">#&gt; iter = 5, ELBO= -1736431.751576, dELBO=0.149807 </span>
<span class="co">#&gt; iter = 6, ELBO= -1522999.405584, dELBO=0.122914 </span>
<span class="co">#&gt; iter = 7, ELBO= -1357841.518372, dELBO=0.108443 </span>
<span class="co">#&gt; iter = 8, ELBO= -1220721.345773, dELBO=0.100984 </span>
<span class="co">#&gt; iter = 9, ELBO= -1102517.724160, dELBO=0.096831 </span>
<span class="co">#&gt; iter = 10, ELBO= -1000213.362081, dELBO=0.092792 </span>
<span class="co">#&gt; iter = 11, ELBO= -912736.321830, dELBO=0.087458 </span>
<span class="co">#&gt; iter = 12, ELBO= -838760.748263, dELBO=0.081048 </span>
<span class="co">#&gt; iter = 13, ELBO= -776459.928856, dELBO=0.074277 </span>
<span class="co">#&gt; iter = 14, ELBO= -723885.812139, dELBO=0.067710 </span>
<span class="co">#&gt; iter = 15, ELBO= -679262.424700, dELBO=0.061644 </span>
<span class="co">#&gt; iter = 16, ELBO= -641097.782565, dELBO=0.056185 </span>
<span class="co">#&gt; iter = 17, ELBO= -608187.747026, dELBO=0.051334 </span>
<span class="co">#&gt; iter = 18, ELBO= -579577.178079, dELBO=0.047042 </span>
<span class="co">#&gt; iter = 19, ELBO= -554512.071439, dELBO=0.043247 </span>
<span class="co">#&gt; iter = 20, ELBO= -532395.975242, dELBO=0.039884 </span>
<span class="co">#&gt; iter = 21, ELBO= -512754.355730, dELBO=0.036893 </span>
<span class="co">#&gt; iter = 22, ELBO= -495206.799519, dELBO=0.034222 </span>
<span class="co">#&gt; iter = 23, ELBO= -479445.770791, dELBO=0.031827 </span>
<span class="co">#&gt; iter = 24, ELBO= -465220.495876, dELBO=0.029670 </span>
<span class="co">#&gt; iter = 25, ELBO= -452324.739398, dELBO=0.027720 </span>
<span class="co">#&gt; iter = 26, ELBO= -440587.496612, dELBO=0.025949 </span>
<span class="co">#&gt; iter = 27, ELBO= -429865.863236, dELBO=0.024335 </span>
<span class="co">#&gt; iter = 28, ELBO= -420039.533751, dELBO=0.022859 </span>
<span class="co">#&gt; iter = 29, ELBO= -411006.523041, dELBO=0.021505 </span>
<span class="co">#&gt; iter = 30, ELBO= -402679.812737, dELBO=0.020259</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_spacoap</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/rankMatrix.html" class="external-link">rankMatrix</a></span><span class="op">(</span><span class="va">reslist</span><span class="op">$</span><span class="va">bbeta</span><span class="op">)</span>
<span class="co">#&gt; [1] 9</span>
<span class="co">#&gt; attr(,"method")</span>
<span class="co">#&gt; [1] "tolNorm2"</span>
<span class="co">#&gt; attr(,"useGrad")</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="co">#&gt; attr(,"tol")</span>
<span class="co">#&gt; [1] 4.440892e-13</span>
<span class="va">svd_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">reslist</span><span class="op">$</span><span class="va">bbeta</span>, nu <span class="op">=</span> <span class="va">hr</span>, nv<span class="op">=</span><span class="va">hr</span><span class="op">)</span>
<span class="va">H_spacoap</span> <span class="op">&lt;-</span> <span class="va">H</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">svd_x</span><span class="op">$</span><span class="va">v</span>
<span class="op">(</span><span class="va">R2_spacoap</span> <span class="op">&lt;-</span> <span class="fu">ProFAST</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ProFAST/man/get_r2_mcfadden.html" class="external-link">get_r2_mcfadden</a></span><span class="op">(</span>embeds<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">H_spacoap</span>, <span class="va">reslist</span><span class="op">$</span><span class="cn">F</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cell_clusters</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # weights:  144 (120 variable)</span>
<span class="co">#&gt; initial  value 5822.645130 </span>
<span class="co">#&gt; iter  10 value 4081.347422</span>
<span class="co">#&gt; iter  20 value 1925.339748</span>
<span class="co">#&gt; iter  30 value 1757.135578</span>
<span class="co">#&gt; iter  40 value 1605.730075</span>
<span class="co">#&gt; iter  50 value 1489.904412</span>
<span class="co">#&gt; iter  60 value 1380.609278</span>
<span class="co">#&gt; iter  70 value 1313.018459</span>
<span class="co">#&gt; iter  80 value 1290.208980</span>
<span class="co">#&gt; iter  90 value 1286.047690</span>
<span class="co">#&gt; iter 100 value 1282.245567</span>
<span class="co">#&gt; final  value 1282.245567 </span>
<span class="co">#&gt; stopped after 100 iterations</span>
<span class="co">#&gt; adjusted McFadden's R2 </span>
<span class="co">#&gt;              0.7742415</span>
<span class="va">featureList</span><span class="op">[[</span><span class="st">'SpaCOAP'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">H_spacoap</span>, <span class="va">reslist</span><span class="op">$</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-spacoap-and-other-methods">Compare SpaCOAP and other methods<a class="anchor" aria-label="anchor" href="#compare-spacoap-and-other-methods"></a>
</h3>
<p>First, we run COAP and calculate the MacFadden’s R-square.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">##COAP</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/COAP" class="external-link">COAP</a></span><span class="op">)</span>
<span class="co">#&gt; COAP :  A covariate-augmented overdispersed Poisson factor model is proposed to jointly perform a high-dimensional Poisson factor analysis and estimate a large coefficient matrix for overdispersed count data.</span>
<span class="co">#&gt; More details can be referred to Liu et al. (2024) &lt;doi:10.1093/biomtc/ujae031&gt;.</span>
<span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">res_coap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/COAP/man/RR_COAP.html" class="external-link">RR_COAP</a></span><span class="op">(</span><span class="va">X_count</span>, Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">H</span><span class="op">)</span>, rank_use<span class="op">=</span> <span class="fl">2</span><span class="op">+</span><span class="va">hr</span>, q<span class="op">=</span><span class="va">hq</span>, 
                    epsELBO <span class="op">=</span> <span class="fl">1e-7</span>, maxIter <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="co">#&gt; Calculate initial values...</span>
<span class="co">#&gt; iter = 2, ELBO= -2277026.134307, dELBO=0.998940 </span>
<span class="co">#&gt; iter = 3, ELBO= -1245400.546031, dELBO=0.453058 </span>
<span class="co">#&gt; iter = 4, ELBO= -784380.759326, dELBO=0.370178 </span>
<span class="co">#&gt; iter = 5, ELBO= -526187.935454, dELBO=0.329168 </span>
<span class="co">#&gt; iter = 6, ELBO= -360619.111292, dELBO=0.314657 </span>
<span class="co">#&gt; iter = 7, ELBO= -245090.315915, dELBO=0.320362 </span>
<span class="co">#&gt; iter = 8, ELBO= -159678.670964, dELBO=0.348490 </span>
<span class="co">#&gt; iter = 9, ELBO= -93827.317884, dELBO=0.412399 </span>
<span class="co">#&gt; iter = 10, ELBO= -41417.237489, dELBO=0.558580 </span>
<span class="co">#&gt; iter = 11, ELBO= 1346.357815, dELBO=1.032507 </span>
<span class="co">#&gt; iter = 12, ELBO= 36944.259437, dELBO=26.440149 </span>
<span class="co">#&gt; iter = 13, ELBO= 67068.244166, dELBO=0.815390 </span>
<span class="co">#&gt; iter = 14, ELBO= 92912.650764, dELBO=0.385345 </span>
<span class="co">#&gt; iter = 15, ELBO= 115345.338266, dELBO=0.241438 </span>
<span class="co">#&gt; iter = 16, ELBO= 135012.535547, dELBO=0.170507 </span>
<span class="co">#&gt; iter = 17, ELBO= 152405.634142, dELBO=0.128826 </span>
<span class="co">#&gt; iter = 18, ELBO= 167905.141515, dELBO=0.101699 </span>
<span class="co">#&gt; iter = 19, ELBO= 181810.428371, dELBO=0.082816 </span>
<span class="co">#&gt; iter = 20, ELBO= 194360.361431, dELBO=0.069028 </span>
<span class="co">#&gt; iter = 21, ELBO= 205747.927052, dELBO=0.058590 </span>
<span class="co">#&gt; iter = 22, ELBO= 216130.796671, dELBO=0.050464 </span>
<span class="co">#&gt; iter = 23, ELBO= 225639.092327, dELBO=0.043993 </span>
<span class="co">#&gt; iter = 24, ELBO= 234381.183033, dELBO=0.038744 </span>
<span class="co">#&gt; iter = 25, ELBO= 242448.072099, dELBO=0.034418 </span>
<span class="co">#&gt; iter = 26, ELBO= 249916.760304, dELBO=0.030805 </span>
<span class="co">#&gt; iter = 27, ELBO= 256852.853998, dELBO=0.027754 </span>
<span class="co">#&gt; iter = 28, ELBO= 263312.609216, dELBO=0.025150 </span>
<span class="co">#&gt; iter = 29, ELBO= 269344.549450, dELBO=0.022908 </span>
<span class="co">#&gt; iter = 30, ELBO= 274990.757597, dELBO=0.020963</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_coap</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">res_coap</span>, <span class="va">time_coap</span>, file<span class="op">=</span><span class="st">'reslist_time_coap.rds'</span><span class="op">)</span>
<span class="va">svd_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">res_coap</span><span class="op">$</span><span class="va">bbeta</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>, nu <span class="op">=</span> <span class="va">hr</span>, nv<span class="op">=</span><span class="va">hr</span><span class="op">)</span>
<span class="va">H_coap</span> <span class="op">&lt;-</span> <span class="va">H</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">svd_x</span><span class="op">$</span><span class="va">v</span>
<span class="op">(</span><span class="va">R2_coap</span> <span class="op">&lt;-</span> <span class="fu">ProFAST</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ProFAST/man/get_r2_mcfadden.html" class="external-link">get_r2_mcfadden</a></span><span class="op">(</span>embeds<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">res_coap</span><span class="op">$</span><span class="va">H</span>, <span class="va">H_coap</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cell_clusters</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # weights:  144 (120 variable)</span>
<span class="co">#&gt; initial  value 5822.645130 </span>
<span class="co">#&gt; iter  10 value 4566.351074</span>
<span class="co">#&gt; iter  20 value 2811.805452</span>
<span class="co">#&gt; iter  30 value 2592.963226</span>
<span class="co">#&gt; iter  40 value 2422.492760</span>
<span class="co">#&gt; iter  50 value 2294.862531</span>
<span class="co">#&gt; iter  60 value 2223.533618</span>
<span class="co">#&gt; iter  70 value 2149.227484</span>
<span class="co">#&gt; iter  80 value 2102.988230</span>
<span class="co">#&gt; iter  90 value 2070.512131</span>
<span class="co">#&gt; iter 100 value 2037.160323</span>
<span class="co">#&gt; final  value 2037.160323 </span>
<span class="co">#&gt; stopped after 100 iterations</span>
<span class="co">#&gt; adjusted McFadden's R2 </span>
<span class="co">#&gt;              0.6414311</span>
<span class="va">featureList</span><span class="op">[[</span><span class="st">'COAP'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">res_coap</span><span class="op">$</span><span class="va">H</span>, <span class="va">H_coap</span><span class="op">)</span></code></pre></div>
<p>Second, we run MRRR and calculate the MacFadden’s R-square.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## MRRR</span>
<span class="va">mrrr_run</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span>, <span class="va">rank0</span>, <span class="va">q</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">family</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
                     <span class="va">familygroup</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>, <span class="va">epsilon</span> <span class="op">=</span> <span class="fl">1e-4</span>, <span class="va">sv.tol</span> <span class="op">=</span> <span class="fl">1e-2</span>,
                     <span class="va">maxIter</span> <span class="op">=</span> <span class="fl">2000</span>, <span class="va">trace</span><span class="op">=</span><span class="cn">TRUE</span>, <span class="va">truncflag</span><span class="op">=</span><span class="cn">FALSE</span>, <span class="va">trunc</span><span class="op">=</span><span class="fl">500</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># epsilon = 1e-4; sv.tol = 1e-2; maxIter = 30; trace=TRUE</span>
  <span class="co"># Y &lt;- X_count; X &lt;- cbind(Z, H); rank0 = r + ncol(Z)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">rrpack</span><span class="op">)</span>
  
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>; <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rank0</span> <span class="op">&lt;-</span> <span class="va">rank0</span><span class="op">+</span><span class="va">q</span>
    <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">truncflag</span><span class="op">)</span><span class="op">{</span>
    <span class="co">## Trunction</span>
    <span class="va">Y</span><span class="op">[</span><span class="va">Y</span><span class="op">&gt;</span><span class="va">trunc</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">trunc</span>
    
  <span class="op">}</span>
  
  <span class="va">svdX0d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">$</span><span class="va">d</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
  <span class="va">init1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>kappaC0 <span class="op">=</span> <span class="va">svdX0d1</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span>
  <span class="va">offset</span> <span class="op">=</span> <span class="cn">NULL</span>
  <span class="va">control</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>epsilon <span class="op">=</span> <span class="va">epsilon</span>, sv.tol <span class="op">=</span> <span class="va">sv.tol</span>, maxit <span class="op">=</span> <span class="va">maxIter</span>,
                 trace <span class="op">=</span> <span class="va">trace</span>, gammaC0 <span class="op">=</span> <span class="fl">1.1</span>, plot.cv <span class="op">=</span> <span class="cn">TRUE</span>,
                 conv.obj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">fit.mrrr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rrpack/man/mrrr.html" class="external-link">mrrr</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">Y</span>, X<span class="op">=</span><span class="va">X</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, family <span class="op">=</span> <span class="va">family</span>, familygroup <span class="op">=</span> <span class="va">familygroup</span>,
                   penstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>penaltySVD <span class="op">=</span> <span class="st">"rankCon"</span>, lambdaSVD <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
                   control <span class="op">=</span> <span class="va">control</span>, init <span class="op">=</span> <span class="va">init1</span>, maxrank <span class="op">=</span> <span class="va">rank0</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">fit.mrrr</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">res_mrrr</span> <span class="op">&lt;-</span> <span class="fu">mrrr_run</span><span class="op">(</span><span class="va">X_count</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Z</span>,<span class="va">H</span><span class="op">)</span>, rank0<span class="op">=</span><span class="va">hr</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span>, q<span class="op">=</span><span class="va">hq</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: rrpack</span>
<span class="co">#&gt; iter =  1  obj/Cnorm_diff =  11918107  </span>
<span class="co">#&gt; iter =  2  obj/Cnorm_diff =  9234143  </span>
<span class="co">#&gt; iter =  3  obj/Cnorm_diff =  8018371  </span>
<span class="co">#&gt; iter =  3  obj/Cnorm_diff =  8018371  </span>
<span class="co">#&gt; iter =  3  obj/Cnorm_diff =  8018371  </span>
<span class="co">#&gt; iter =  3  obj/Cnorm_diff =  8018371  </span>
<span class="co">#&gt; iter =  3  obj/Cnorm_diff =  8018371  </span>
<span class="co">#&gt; iter =  3  obj/Cnorm_diff =  8018371  </span>
<span class="co">#&gt; iter =  3  obj/Cnorm_diff =  8018371</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res_mrrr</span><span class="op">)</span>
<span class="co">#&gt; List of 16</span>
<span class="co">#&gt;  $ call        : language mrrr(Y = Y, X = X[, -1], family = family, familygroup = familygroup, maxrank = rank0,      penstr = list(penaltyS| __truncated__ ...</span>
<span class="co">#&gt;  $ iter        : num 3</span>
<span class="co">#&gt;  $ iter_actural: num 9</span>
<span class="co">#&gt;  $ obj         : num [1:5] 11918107 9234143 8018371 7474120 8172183</span>
<span class="co">#&gt;  $ converged   : logi TRUE</span>
<span class="co">#&gt;  $ diff        : num [1:3] 0.2252 0.1317 0.0679</span>
<span class="co">#&gt;  $ ctrl.id     : num 1</span>
<span class="co">#&gt;  $ family      :List of 1</span>
<span class="co">#&gt;   ..$ :List of 12</span>
<span class="co">#&gt;   .. ..$ family    : chr "poisson"</span>
<span class="co">#&gt;   .. ..$ link      : chr "log"</span>
<span class="co">#&gt;   .. ..$ linkfun   :function (mu)  </span>
<span class="co">#&gt;   .. ..$ linkinv   :function (eta)  </span>
<span class="co">#&gt;   .. ..$ variance  :function (mu)  </span>
<span class="co">#&gt;   .. ..$ dev.resids:function (y, mu, wt)  </span>
<span class="co">#&gt;   .. ..$ aic       :function (y, n, mu, wt, dev)  </span>
<span class="co">#&gt;   .. ..$ mu.eta    :function (eta)  </span>
<span class="co">#&gt;   .. ..$ initialize:  expression({  if (any(y &lt; 0))  stop("negative values not allowed for the 'Poisson' family")  n &lt;- rep.int(1, nobs| __truncated__</span>
<span class="co">#&gt;   .. ..$ validmu   :function (mu)  </span>
<span class="co">#&gt;   .. ..$ valideta  :function (eta)  </span>
<span class="co">#&gt;   .. ..$ simulate  :function (object, nsim)  </span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "family"</span>
<span class="co">#&gt;  $ Phitrace    : num [1:2000, 1:2000] 1 1 1 1 1 NA NA NA NA NA ...</span>
<span class="co">#&gt;  $ kappaC0Trace: num [1:4] 6838 6838 6217 6838</span>
<span class="co">#&gt;  $ penaltySVD  :function (x, lambda)  </span>
<span class="co">#&gt;  $ lambdaSVD   : num 1</span>
<span class="co">#&gt;  $ mu          : num [1:2650, 1:2000] 1.12 1.12 1.12 1.12 1.13 ...</span>
<span class="co">#&gt;  $ coef        : num [1:2672, 1:2000] 0.000162 0.000948 0.001008 0.001038 0.000935 ...</span>
<span class="co">#&gt;  $ dispersion  : num [1:2000] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ rank        : int 1</span>
<span class="co">#&gt;  - attr(*, "class")= chr "mrrr"</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_mrrr</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="va">hbbeta_mrrr</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">res_mrrr</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Z</span>,<span class="va">H</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span>
<span class="va">svd_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">hbbeta_mrrr</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>, nu <span class="op">=</span> <span class="va">hr</span>, nv<span class="op">=</span><span class="va">hr</span><span class="op">)</span>
<span class="va">H_mrrr</span> <span class="op">&lt;-</span> <span class="va">H</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">svd_x</span><span class="op">$</span><span class="va">v</span>
<span class="va">Theta_hb</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">res_mrrr</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Z</span>,<span class="va">H</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Z</span>,<span class="va">H</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Z</span>,<span class="va">H</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span>
<span class="va">svdTheta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">Theta_hb</span>, nu<span class="op">=</span><span class="va">hq</span>, nv<span class="op">=</span><span class="va">hq</span><span class="op">)</span>
<span class="va">F_mrrr</span> <span class="op">&lt;-</span> <span class="va">svdTheta</span><span class="op">$</span><span class="va">u</span>
<span class="op">(</span><span class="va">R2_mrrr</span> <span class="op">&lt;-</span> <span class="fu">ProFAST</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ProFAST/man/get_r2_mcfadden.html" class="external-link">get_r2_mcfadden</a></span><span class="op">(</span>embeds<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">H_mrrr</span>, <span class="va">F_mrrr</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cell_clusters</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # weights:  144 (120 variable)</span>
<span class="co">#&gt; initial  value 5822.645130 </span>
<span class="co">#&gt; iter  10 value 5135.547940</span>
<span class="co">#&gt; iter  20 value 2664.903733</span>
<span class="co">#&gt; iter  30 value 2218.949085</span>
<span class="co">#&gt; iter  40 value 2052.880889</span>
<span class="co">#&gt; iter  50 value 1993.590598</span>
<span class="co">#&gt; iter  60 value 1963.273668</span>
<span class="co">#&gt; iter  70 value 1900.133460</span>
<span class="co">#&gt; iter  80 value 1858.499763</span>
<span class="co">#&gt; iter  90 value 1839.520366</span>
<span class="co">#&gt; iter 100 value 1824.798415</span>
<span class="co">#&gt; final  value 1824.798415 </span>
<span class="co">#&gt; stopped after 100 iterations</span>
<span class="co">#&gt; adjusted McFadden's R2 </span>
<span class="co">#&gt;              0.6787915</span>
<span class="va">featureList</span><span class="op">[[</span><span class="st">'MRRR'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">H_mrrr</span>, <span class="va">F_mrrr</span><span class="op">)</span></code></pre></div>
<p>Finally, we execute FAST and compute the MacFadden’s R-squared. It is worth noting that we refrain from comparing with PLNPCA in this demo due to its time-consuming nature.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fast_run</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X_count</span>, <span class="va">Adj_sp</span>, <span class="va">q</span>, <span class="va">verbose</span><span class="op">=</span><span class="cn">TRUE</span>, <span class="va">epsELBO</span><span class="op">=</span><span class="fl">1e-8</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/ProFAST" class="external-link">ProFAST</a></span><span class="op">)</span>

  <span class="va">reslist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProFAST/man/FAST_run.html" class="external-link">FAST_run</a></span><span class="op">(</span>XList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">X_count</span><span class="op">)</span>, 
                      AdjList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Adj_sp</span><span class="op">)</span>, q <span class="op">=</span> <span class="va">q</span>, fit.model <span class="op">=</span> <span class="st">'poisson'</span>, 
                      verbose<span class="op">=</span><span class="va">verbose</span>, epsLogLik<span class="op">=</span><span class="va">epsELBO</span><span class="op">)</span>
  <span class="va">reslist</span><span class="op">$</span><span class="va">hV</span> <span class="op">&lt;-</span> <span class="va">reslist</span><span class="op">$</span><span class="va">hV</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">reslist</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">res_fast</span> <span class="op">&lt;-</span> <span class="fu">fast_run</span><span class="op">(</span><span class="va">X_count</span>, <span class="va">Adj_sp</span>, q<span class="op">=</span><span class="va">hq</span>, verbose<span class="op">=</span><span class="cn">TRUE</span>, epsELBO<span class="op">=</span><span class="fl">1e-8</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: ProFAST</span>
<span class="co">#&gt; Loading required package: gtools</span>
<span class="co">#&gt; Finish variable initialization </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 2, ELBO= -139676644.571706, dELBO=0.934958 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 3, ELBO= -2669056.086013, dELBO=0.980891 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 4, ELBO= -2431176.956188, dELBO=0.089125 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 5, ELBO= -2265756.140995, dELBO=0.068041 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 6, ELBO= -2137493.048256, dELBO=0.056609 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 7, ELBO= -2033013.883353, dELBO=0.048879 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 8, ELBO= -1945077.102715, dELBO=0.043254 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 9, ELBO= -1869305.819990, dELBO=0.038955 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 10, ELBO= -1802851.126364, dELBO=0.035550 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 11, ELBO= -1743754.618302, dELBO=0.032779 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 12, ELBO= -1690612.458189, dELBO=0.030476 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 13, ELBO= -1642384.316164, dELBO=0.028527 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 14, ELBO= -1598278.082891, dELBO=0.026855 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 15, ELBO= -1557676.919636, dELBO=0.025403 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 16, ELBO= -1520091.258369, dELBO=0.024129 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 17, ELBO= -1485126.166477, dELBO=0.023002 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 18, ELBO= -1452458.530060, dELBO=0.021997 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 19, ELBO= -1421820.713325, dELBO=0.021094 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 20, ELBO= -1392988.607898, dELBO=0.020278 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 21, ELBO= -1365772.729876, dELBO=0.019538 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 22, ELBO= -1340011.477924, dELBO=0.018862 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 23, ELBO= -1315565.952619, dELBO=0.018243 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 24, ELBO= -1292315.922816, dELBO=0.017673 </span>
<span class="co">#&gt; Satrt ICM step! </span>
<span class="co">#&gt; iter = 25, ELBO= -1270156.647533, dELBO=0.017147</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_fast</span> <span class="op">&lt;-</span> <span class="va">toc</span> <span class="op">-</span> <span class="va">tic</span>
<span class="op">(</span><span class="va">R2_fast</span> <span class="op">&lt;-</span> <span class="fu">ProFAST</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ProFAST/man/get_r2_mcfadden.html" class="external-link">get_r2_mcfadden</a></span><span class="op">(</span>embeds<span class="op">=</span> <span class="va">res_fast</span><span class="op">$</span><span class="va">hV</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cell_clusters</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # weights:  63 (48 variable)</span>
<span class="co">#&gt; initial  value 5822.645130 </span>
<span class="co">#&gt; iter  10 value 3602.597315</span>
<span class="co">#&gt; iter  20 value 3532.188016</span>
<span class="co">#&gt; iter  30 value 3456.146127</span>
<span class="co">#&gt; iter  40 value 3262.630126</span>
<span class="co">#&gt; iter  50 value 3077.335351</span>
<span class="co">#&gt; iter  60 value 2961.765715</span>
<span class="co">#&gt; final  value 2961.685580 </span>
<span class="co">#&gt; converged</span>
<span class="co">#&gt; adjusted McFadden's R2 </span>
<span class="co">#&gt;              0.4787815</span>
<span class="va">featureList</span><span class="op">[[</span><span class="st">'FAST'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res_fast</span><span class="op">$</span><span class="va">hV</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summarize-the-metrics">Summarize the metrics<a class="anchor" aria-label="anchor" href="#summarize-the-metrics"></a>
</h3>
<p>We evaluate the correlation between the low-dimensional representations learned by SpaCOAP and other methods with the annotated cell clusters using two metrics. The first metric is the adjusted MacFadden’s <span class="math inline">\(\mathrm{R}^2\)</span>, referred to as <span class="math inline">\(\mathrm{MacR}^2\)</span>. This measure quantifies the amount of biological information captured by the representations, where a higher value signifies superior performance in representation learning.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">R2List</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">cell_label</span> <span class="op">&lt;-</span> <span class="va">cell_clusters</span>
<span class="kw">for</span><span class="op">(</span><span class="va">im</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">featureList</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"im = "</span>, <span class="va">im</span><span class="op">)</span>
  <span class="va">R2List</span><span class="op">[[</span><span class="va">im</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">ProFAST</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ProFAST/man/get_r2_mcfadden.html" class="external-link">get_r2_mcfadden</a></span><span class="op">(</span>embeds<span class="op">=</span> <span class="va">featureList</span><span class="op">[[</span><span class="va">im</span><span class="op">]</span><span class="op">]</span>, y<span class="op">=</span><span class="va">cell_label</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; im = 1</span>
<span class="co">#&gt; # weights:  144 (120 variable)</span>
<span class="co">#&gt; initial  value 5822.645130 </span>
<span class="co">#&gt; iter  10 value 4081.347422</span>
<span class="co">#&gt; iter  20 value 1925.339748</span>
<span class="co">#&gt; iter  30 value 1757.135578</span>
<span class="co">#&gt; iter  40 value 1605.730075</span>
<span class="co">#&gt; iter  50 value 1489.904412</span>
<span class="co">#&gt; iter  60 value 1380.609278</span>
<span class="co">#&gt; iter  70 value 1313.018459</span>
<span class="co">#&gt; iter  80 value 1290.208980</span>
<span class="co">#&gt; iter  90 value 1286.047690</span>
<span class="co">#&gt; iter 100 value 1282.245567</span>
<span class="co">#&gt; final  value 1282.245567 </span>
<span class="co">#&gt; stopped after 100 iterations</span>
<span class="co">#&gt; im = 2</span>
<span class="co">#&gt; # weights:  144 (120 variable)</span>
<span class="co">#&gt; initial  value 5822.645130 </span>
<span class="co">#&gt; iter  10 value 4566.351074</span>
<span class="co">#&gt; iter  20 value 2811.805452</span>
<span class="co">#&gt; iter  30 value 2592.963226</span>
<span class="co">#&gt; iter  40 value 2422.492760</span>
<span class="co">#&gt; iter  50 value 2294.862531</span>
<span class="co">#&gt; iter  60 value 2223.533618</span>
<span class="co">#&gt; iter  70 value 2149.227484</span>
<span class="co">#&gt; iter  80 value 2102.988230</span>
<span class="co">#&gt; iter  90 value 2070.512131</span>
<span class="co">#&gt; iter 100 value 2037.160323</span>
<span class="co">#&gt; final  value 2037.160323 </span>
<span class="co">#&gt; stopped after 100 iterations</span>
<span class="co">#&gt; im = 3</span>
<span class="co">#&gt; # weights:  144 (120 variable)</span>
<span class="co">#&gt; initial  value 5822.645130 </span>
<span class="co">#&gt; iter  10 value 5135.547940</span>
<span class="co">#&gt; iter  20 value 2664.903733</span>
<span class="co">#&gt; iter  30 value 2218.949085</span>
<span class="co">#&gt; iter  40 value 2052.880889</span>
<span class="co">#&gt; iter  50 value 1993.590598</span>
<span class="co">#&gt; iter  60 value 1963.273668</span>
<span class="co">#&gt; iter  70 value 1900.133460</span>
<span class="co">#&gt; iter  80 value 1858.499763</span>
<span class="co">#&gt; iter  90 value 1839.520366</span>
<span class="co">#&gt; iter 100 value 1824.798415</span>
<span class="co">#&gt; final  value 1824.798415 </span>
<span class="co">#&gt; stopped after 100 iterations</span>
<span class="co">#&gt; im = 4</span>
<span class="co">#&gt; # weights:  63 (48 variable)</span>
<span class="co">#&gt; initial  value 5822.645130 </span>
<span class="co">#&gt; iter  10 value 3602.597315</span>
<span class="co">#&gt; iter  20 value 3532.188016</span>
<span class="co">#&gt; iter  30 value 3456.146127</span>
<span class="co">#&gt; iter  40 value 3262.630126</span>
<span class="co">#&gt; iter  50 value 3077.335351</span>
<span class="co">#&gt; iter  60 value 2961.765715</span>
<span class="co">#&gt; final  value 2961.685580 </span>
<span class="co">#&gt; converged</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">R2List</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">featureList</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">R2Vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">R2List</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">R2Vec</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">R2List</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">R2Vec</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="mouseSpleen_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Finally, we employ a classification model trained through randomForest, leveraging the cell clusters and the learned low-dimensional representations by SpaCOAP and other methods. We then compare the prediction performance of this model. To achieve this, we randomly divide the samples into training and testing data with a ratio of <span class="math inline">\(7:3\)</span>. We evaluate the model’s performance using prediction accuracy (ACC) and Cohen’s Kappa on the testing data. In contrast of ACC, Kappa offers a more robust measure of accuracy, as it takes into account the possibility that the agreement occurs by chance. We repeat this division process ten times to ensure the reliability of our findings.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cell_label</span><span class="op">)</span>
<span class="va">methodNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SpaCOAP"</span>, <span class="st">"COAP"</span>,  <span class="st">"MRRR"</span>, <span class="st">"FAST"</span><span class="op">)</span>
<span class="va">n_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">methodNames</span><span class="op">)</span>
<span class="va">metricList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ACC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">N</span>, <span class="va">n_methods</span><span class="op">)</span>, Kappa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">N</span>, <span class="va">n_methods</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">metricList</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">metricList</span><span class="op">[[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">methodNames</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span>
<span class="co">#&gt; randomForest 4.7-1</span>
<span class="co">#&gt; Type rfNews() to see new features/changes/bug fixes.</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># i &lt;- 1</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"i = "</span>, <span class="va">i</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">idx_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="fl">0.7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">idx_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="va">idx_train</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rf_spacoap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'SpaCOAP'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">idx_train</span>,<span class="op">]</span>, y<span class="op">=</span><span class="va">cell_label</span><span class="op">[</span><span class="va">idx_train</span><span class="op">]</span><span class="op">)</span>
  <span class="va">hy_spacoap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf_spacoap</span>, newdata<span class="op">=</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'SpaCOAP'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">idx_test</span>,<span class="op">]</span><span class="op">)</span>
  <span class="va">metricList</span><span class="op">$</span><span class="va">ACC</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">acc_fun</span><span class="op">(</span><span class="va">hy_spacoap</span>, <span class="va">cell_label</span><span class="op">[</span><span class="va">idx_test</span><span class="op">]</span><span class="op">)</span>
  <span class="va">metricList</span><span class="op">$</span><span class="va">Kappa</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">kappa_fun</span><span class="op">(</span><span class="va">hy_spacoap</span>, <span class="va">cell_label</span><span class="op">[</span><span class="va">idx_test</span><span class="op">]</span><span class="op">)</span>
  
  <span class="va">rf_coap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'COAP'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">idx_train</span>,<span class="op">]</span>, y<span class="op">=</span><span class="va">cell_label</span><span class="op">[</span><span class="va">idx_train</span><span class="op">]</span><span class="op">)</span>
  <span class="va">hy_coap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf_coap</span>, newdata<span class="op">=</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'COAP'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">idx_test</span>,<span class="op">]</span><span class="op">)</span>
  <span class="va">metricList</span><span class="op">$</span><span class="va">ACC</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">acc_fun</span><span class="op">(</span><span class="va">hy_coap</span>, <span class="va">cell_label</span><span class="op">[</span><span class="va">idx_test</span><span class="op">]</span><span class="op">)</span>
  <span class="va">metricList</span><span class="op">$</span><span class="va">Kappa</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">kappa_fun</span><span class="op">(</span><span class="va">hy_coap</span>, <span class="va">cell_label</span><span class="op">[</span><span class="va">idx_test</span><span class="op">]</span><span class="op">)</span>
 
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'MRRR'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"MRRR"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'MRRR'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rf_MRRR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'MRRR'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">idx_train</span>,<span class="op">]</span>, y<span class="op">=</span><span class="va">cell_label</span><span class="op">[</span><span class="va">idx_train</span><span class="op">]</span><span class="op">)</span>
  <span class="va">hy_MRRR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf_MRRR</span>, newdata<span class="op">=</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'MRRR'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">idx_test</span>,<span class="op">]</span><span class="op">)</span>
  <span class="va">metricList</span><span class="op">$</span><span class="va">ACC</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">acc_fun</span><span class="op">(</span><span class="va">hy_MRRR</span>, <span class="va">cell_label</span><span class="op">[</span><span class="va">idx_test</span><span class="op">]</span><span class="op">)</span>
  <span class="va">metricList</span><span class="op">$</span><span class="va">Kappa</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">kappa_fun</span><span class="op">(</span><span class="va">hy_MRRR</span>, <span class="va">cell_label</span><span class="op">[</span><span class="va">idx_test</span><span class="op">]</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'FAST'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"FAST"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'FAST'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rf_FAST</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'FAST'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">idx_train</span>,<span class="op">]</span>, y<span class="op">=</span><span class="va">cell_label</span><span class="op">[</span><span class="va">idx_train</span><span class="op">]</span><span class="op">)</span>
  <span class="va">hy_FAST</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf_FAST</span>, newdata<span class="op">=</span><span class="va">featureList</span><span class="op">[[</span><span class="st">'FAST'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">idx_test</span>,<span class="op">]</span><span class="op">)</span>
  <span class="va">metricList</span><span class="op">$</span><span class="va">ACC</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">acc_fun</span><span class="op">(</span><span class="va">hy_FAST</span>, <span class="va">cell_label</span><span class="op">[</span><span class="va">idx_test</span><span class="op">]</span><span class="op">)</span>
  <span class="va">metricList</span><span class="op">$</span><span class="va">Kappa</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">kappa_fun</span><span class="op">(</span><span class="va">hy_FAST</span>, <span class="va">cell_label</span><span class="op">[</span><span class="va">idx_test</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; i = 1</span>
<span class="co">#&gt; Loading required package: irr</span>
<span class="co">#&gt; Warning: package 'irr' was built under R version 4.1.3</span>
<span class="co">#&gt; Loading required package: lpSolve</span>
<span class="co">#&gt; i = 2</span>
<span class="co">#&gt; i = 3</span>
<span class="co">#&gt; i = 4</span>
<span class="co">#&gt; i = 5</span>
<span class="co">#&gt; i = 6</span>
<span class="co">#&gt; i = 7</span>
<span class="co">#&gt; i = 8</span>
<span class="co">#&gt; i = 9</span>
<span class="co">#&gt; i = 10</span>

<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">metricList</span>, <span class="va">colMeans</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-e83615c1d9155a18262a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e83615c1d9155a18262a">{"x":{"filter":"none","vertical":false,"data":[["ACC","Kappa"],[0.75,0.72],[0.66,0.61],[0.7,0.66],[0.53,0.46]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>SpaCOAP<\/th>\n      <th>COAP<\/th>\n      <th>MRRR<\/th>\n      <th>FAST<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><details><p><summary><strong>Session Info</strong></summary></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 4.1.2 (2021-11-01)</span>
<span class="co">#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)</span>
<span class="co">#&gt; Running under: Windows 10 x64 (build 22631)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] LC_COLLATE=Chinese (Simplified)_China.936 </span>
<span class="co">#&gt; [2] LC_CTYPE=Chinese (Simplified)_China.936   </span>
<span class="co">#&gt; [3] LC_MONETARY=Chinese (Simplified)_China.936</span>
<span class="co">#&gt; [4] LC_NUMERIC=C                              </span>
<span class="co">#&gt; [5] LC_TIME=Chinese (Simplified)_China.936    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt;  [1] irr_0.84.1         lpSolve_5.6.15     randomForest_4.7-1 ProFAST_1.4       </span>
<span class="co">#&gt;  [5] gtools_3.9.2.2     rrpack_0.1-11      COAP_1.2           irlba_2.3.5       </span>
<span class="co">#&gt;  [9] Matrix_1.4-0       SpaCOAP_1.2       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;   [1] rappdirs_0.3.3              scattermore_0.8            </span>
<span class="co">#&gt;   [3] ggthemes_4.2.4              GiRaF_1.0.1                </span>
<span class="co">#&gt;   [5] SeuratObject_4.1.0          ragg_1.2.2                 </span>
<span class="co">#&gt;   [7] tidyr_1.2.0                 ggplot2_3.4.1              </span>
<span class="co">#&gt;   [9] bit64_4.0.5                 knitr_1.37                 </span>
<span class="co">#&gt;  [11] DelayedArray_0.20.0         data.table_1.14.2          </span>
<span class="co">#&gt;  [13] rpart_4.1.16                KEGGREST_1.34.0            </span>
<span class="co">#&gt;  [15] RCurl_1.98-1.6              generics_0.1.2             </span>
<span class="co">#&gt;  [17] BiocGenerics_0.40.0         org.Mm.eg.db_3.14.0        </span>
<span class="co">#&gt;  [19] ScaledMatrix_1.2.0          cowplot_1.1.1              </span>
<span class="co">#&gt;  [21] RSQLite_2.2.10              RANN_2.6.1                 </span>
<span class="co">#&gt;  [23] future_1.26.1               bit_4.0.4                  </span>
<span class="co">#&gt;  [25] spatstat.data_3.0-0         xml2_1.3.3                 </span>
<span class="co">#&gt;  [27] httpuv_1.6.5                SummarizedExperiment_1.24.0</span>
<span class="co">#&gt;  [29] assertthat_0.2.1            viridis_0.6.2              </span>
<span class="co">#&gt;  [31] xfun_0.29                   hms_1.1.1                  </span>
<span class="co">#&gt;  [33] jquerylib_0.1.4             evaluate_0.15              </span>
<span class="co">#&gt;  [35] promises_1.2.0.1            fansi_1.0.4                </span>
<span class="co">#&gt;  [37] progress_1.2.2              dbplyr_2.1.1               </span>
<span class="co">#&gt;  [39] igraph_1.3.5                DBI_1.1.2                  </span>
<span class="co">#&gt;  [41] htmlwidgets_1.5.4           spatstat.geom_2.4-0        </span>
<span class="co">#&gt;  [43] stats4_4.1.2                purrr_0.3.4                </span>
<span class="co">#&gt;  [45] ellipsis_0.3.2              crosstalk_1.2.0            </span>
<span class="co">#&gt;  [47] dplyr_1.0.9                 ggpubr_0.4.0               </span>
<span class="co">#&gt;  [49] backports_1.4.1             DR.SC_3.4                  </span>
<span class="co">#&gt;  [51] insight_0.17.0              biomaRt_2.50.3             </span>
<span class="co">#&gt;  [53] deldir_1.0-6                sparseMatrixStats_1.6.0    </span>
<span class="co">#&gt;  [55] MatrixGenerics_1.6.0        vctrs_0.6.1                </span>
<span class="co">#&gt;  [57] SingleCellExperiment_1.16.0 Biobase_2.54.0             </span>
<span class="co">#&gt;  [59] ROCR_1.0-11                 abind_1.4-5                </span>
<span class="co">#&gt;  [61] cachem_1.0.6                PRECAST_1.6.3              </span>
<span class="co">#&gt;  [63] progressr_0.10.1            sctransform_0.3.3          </span>
<span class="co">#&gt;  [65] prettyunits_1.1.1           mclust_5.4.10              </span>
<span class="co">#&gt;  [67] goftest_1.2-3               cluster_2.1.2              </span>
<span class="co">#&gt;  [69] lazyeval_0.2.2              crayon_1.5.1               </span>
<span class="co">#&gt;  [71] glmnet_4.1-3                pkgconfig_2.0.3            </span>
<span class="co">#&gt;  [73] GenomeInfoDb_1.30.1         nlme_3.1-155               </span>
<span class="co">#&gt;  [75] vipor_0.4.5                 nnet_7.3-17                </span>
<span class="co">#&gt;  [77] rlang_1.1.0                 globals_0.15.0             </span>
<span class="co">#&gt;  [79] lifecycle_1.0.3             miniUI_0.1.1.1             </span>
<span class="co">#&gt;  [81] LaplacesDemon_16.1.6        filelock_1.0.2             </span>
<span class="co">#&gt;  [83] BiocFileCache_2.2.1         rsvd_1.0.5                 </span>
<span class="co">#&gt;  [85] rprojroot_2.0.3             polyclip_1.10-0            </span>
<span class="co">#&gt;  [87] matrixStats_0.62.0          lmtest_0.9-40              </span>
<span class="co">#&gt;  [89] carData_3.0-5               zoo_1.8-10                 </span>
<span class="co">#&gt;  [91] beeswarm_0.4.0              ggridges_0.5.3             </span>
<span class="co">#&gt;  [93] png_0.1-7                   viridisLite_0.4.1          </span>
<span class="co">#&gt;  [95] bitops_1.0-7                KernSmooth_2.23-20         </span>
<span class="co">#&gt;  [97] Biostrings_2.62.0           blob_1.2.2                 </span>
<span class="co">#&gt;  [99] DelayedMatrixStats_1.16.0   shape_1.4.6                </span>
<span class="co">#&gt; [101] stringr_1.4.0               parallelly_1.32.0          </span>
<span class="co">#&gt; [103] spatstat.random_2.2-0       rstatix_0.7.0              </span>
<span class="co">#&gt; [105] S4Vectors_0.32.3            ggsignif_0.6.3             </span>
<span class="co">#&gt; [107] beachmat_2.10.0             scales_1.2.1               </span>
<span class="co">#&gt; [109] memoise_2.0.1               magrittr_2.0.3             </span>
<span class="co">#&gt; [111] plyr_1.8.7                  ica_1.0-2                  </span>
<span class="co">#&gt; [113] zlibbioc_1.40.0             compiler_4.1.2             </span>
<span class="co">#&gt; [115] RColorBrewer_1.1-3          fitdistrplus_1.1-8         </span>
<span class="co">#&gt; [117] cli_3.2.0                   XVector_0.34.0             </span>
<span class="co">#&gt; [119] listenv_0.8.0               patchwork_1.1.1            </span>
<span class="co">#&gt; [121] pbapply_1.5-0               MASS_7.3-55                </span>
<span class="co">#&gt; [123] mgcv_1.8-39                 tidyselect_1.1.2           </span>
<span class="co">#&gt; [125] stringi_1.7.6               textshaping_0.3.6          </span>
<span class="co">#&gt; [127] highr_0.9                   yaml_2.3.6                 </span>
<span class="co">#&gt; [129] BiocSingular_1.10.0         ggrepel_0.9.1              </span>
<span class="co">#&gt; [131] grid_4.1.2                  sass_0.4.1                 </span>
<span class="co">#&gt; [133] tools_4.1.2                 future.apply_1.9.0         </span>
<span class="co">#&gt; [135] parallel_4.1.2              rstudioapi_0.13            </span>
<span class="co">#&gt; [137] foreach_1.5.2               gridExtra_2.3              </span>
<span class="co">#&gt; [139] Rtsne_0.16                  digest_0.6.29              </span>
<span class="co">#&gt; [141] rgeos_0.5-9                 shiny_1.7.1                </span>
<span class="co">#&gt; [143] Rcpp_1.0.10                 GenomicRanges_1.46.1       </span>
<span class="co">#&gt; [145] car_3.0-12                  broom_0.7.12               </span>
<span class="co">#&gt; [147] scuttle_1.4.0               performance_0.8.0          </span>
<span class="co">#&gt; [149] later_1.3.0                 harmony_0.1.0              </span>
<span class="co">#&gt; [151] RcppAnnoy_0.0.19            org.Hs.eg.db_3.14.0        </span>
<span class="co">#&gt; [153] httr_1.4.3                  AnnotationDbi_1.56.2       </span>
<span class="co">#&gt; [155] colorspace_2.1-0            XML_3.99-0.9               </span>
<span class="co">#&gt; [157] fs_1.5.2                    tensor_1.5                 </span>
<span class="co">#&gt; [159] reticulate_1.25             IRanges_2.28.0             </span>
<span class="co">#&gt; [161] splines_4.1.2               uwot_0.1.11                </span>
<span class="co">#&gt; [163] spatstat.utils_3.0-1        pkgdown_2.0.6              </span>
<span class="co">#&gt; [165] scater_1.25.1               sp_1.5-0                   </span>
<span class="co">#&gt; [167] lassoshooting_0.1.5-1       plotly_4.10.0              </span>
<span class="co">#&gt; [169] systemfonts_1.0.4           xtable_1.8-4               </span>
<span class="co">#&gt; [171] jsonlite_1.8.0              R6_2.5.1                   </span>
<span class="co">#&gt; [173] pillar_1.9.0                htmltools_0.5.2            </span>
<span class="co">#&gt; [175] mime_0.12                   DT_0.21                    </span>
<span class="co">#&gt; [177] glue_1.6.2                  fastmap_1.1.0              </span>
<span class="co">#&gt; [179] BiocParallel_1.28.3         BiocNeighbors_1.12.0       </span>
<span class="co">#&gt; [181] codetools_0.2-18            furrr_0.3.1                </span>
<span class="co">#&gt; [183] utf8_1.2.3                  lattice_0.20-45            </span>
<span class="co">#&gt; [185] bslib_0.3.1                 spatstat.sparse_2.1-1      </span>
<span class="co">#&gt; [187] tibble_3.2.1                curl_4.3.2                 </span>
<span class="co">#&gt; [189] ggbeeswarm_0.6.0            leiden_0.4.2               </span>
<span class="co">#&gt; [191] survival_3.2-13             CompQuadForm_1.4.3         </span>
<span class="co">#&gt; [193] rmarkdown_2.11              desc_1.4.0                 </span>
<span class="co">#&gt; [195] munsell_0.5.0               GenomeInfoDbData_1.2.7     </span>
<span class="co">#&gt; [197] iterators_1.0.14            reshape2_1.4.4             </span>
<span class="co">#&gt; [199] gtable_0.3.3                spatstat.core_2.4-4        </span>
<span class="co">#&gt; [201] Seurat_4.1.1</span></code></pre></div>
</details>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Wei Liu, Qingzhi Zhong.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
